# Copy to docker-compose.yml and adjust volume paths to your video locations.
# docker-compose.yml is gitignored (machine-specific paths).
#
# Prerequisites:
#   - Docker Desktop with WSL2 backend
#   - NVIDIA GPU driver (nvidia-smi should work from host)
#   - HuggingFace token with pyannote access:
#       1. Accept terms at https://huggingface.co/pyannote/speaker-diarization-3.1
#       2. Set env var: HUGGINGFACE_TOKEN=hf_your_token_here
#
# Usage:
#   docker compose build                          # one-time (~5 min)
#   docker compose run whisperx status            # pipeline progress
#   docker compose run whisperx process --workers 1  # GPU-accelerated
#   docker compose run whisperx embed-clusters    # batch clustering

services:
  whisperx:
    build: .
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    volumes:
      - .:/app
      # Mount your video directories read-only. The container expects
      # /shows-d and /shows-s â€” the script auto-detects these paths.
      - /path/to/videos-1:/shows-d:ro
      - /path/to/videos-2:/shows-s:ro
    environment:
      - HF_TOKEN=${HUGGINGFACE_TOKEN}
